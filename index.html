<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Your First Drupal 8 Module</title>

    <meta name="author" content="Larry Garfield, Robin Barre">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/palantir-reveal.css">
    <link rel="stylesheet" href="css/theme/palantir.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/palantir-zenburn.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <link rel="stylesheet" href="css/print/pdf.css" type="text/css" media="print">

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">


        <!-- INTRODUCTORY SLIDES -->
        <section>
          <section>
            <h1>Welcome</h1>
            <h2>Your First Drupal 8 Module</h2>
          </section>

          <section>
            <h1>Trainers</h1>
            <h2>Robin Barre</h2>
            <h2>Larry Garfield</h2>
          </section>
          <section>
            <h1>Lab Format</h1>
            <ul>
              <li class="">Short lecture</li>
              <li class="">Lab exercise</li>
              <li class="">Pair programming</li>
              <li class="">Assuming basic understanding of:
                <ul>
                  <li>namespaces</li>
                  <li>interfaces</li>
                  <li>PSR-0</li>
                  <li>CMI</li>
                </ul>
              </li>

            </ul>
            <aside class="notes">
            </aside>
          </section>
          <section>
            <h1>Goals</h1>
            <h3>SWBAT*</h3>
            <ul>
              <li class="fragment">Create routes and controllers for requests</li>
              <li class="fragment">Define common module plugins</li>
              <li class="fragment">Store default module settings</li>
              <li class="fragment">Create pages and blocks and state</li>
              <li class="fragment">Inspire you to learn more about Drupal 8</li>
            </ul>
          </section>

          <section>
            <h1>Outline</h1>
            <ul>
              <li class="fragment">HttpKernel</li>
              <li class="fragment">Routing/Controller</li>
              <li class="fragment">Theming Basics</li>
              <li class="fragment">Forms and configuration</li>
              <li class="fragment">Dependency Injection</li>
              <li class="fragment">Forms and Configuration</li>
              <li class="fragment">Plugins/Annotations</li>
            </ul>
          </section>
          <section>
            <h2>Module structure (PSR-0)</h2>
            <pre><code>
mymodule/
  mymodule.info.yml
  mymodule.module
  mymodule.routing.yml
  mymodule.services.yml
    lib/
      Drupal/
        Controller/
          MyModuleController.php
        Plugin/
          Action/
            MyModuleCreateRainbows.php
            MyModuleGetPuppies.php
          Block/
            MyModuleHelloWorldBlock.php
            MyModuleGoodbyeCruelWorldBlock.php</code></pre>
          </section>
          <section>
            <h2>Drupalgotchi Introduction</h2>
          </section>
        </section>

        <!-- // END INTRODUCTORY SLIDES -->

        <section>
          <section>
            <h1>Understanding the web</h1>
          </section>
          <section>
            <h3>PHP 4 architecture</h3>
            <img src="img/architecture-php4.svg"  class="graphic" />
          </section>
          <section>
            <h3>HTTP Architecture</h3>
            <img src="img/architecture-http.svg" class="graphic"/>
          </section>
          <section>
            <h3>Symfony/HttpKernel architecture</h3>
            <img src="img/architecture-httpkernelinterface.svg" class="graphic"/>
          </section>
          <section>
            <pre class="long_code"><code class="php">interface HttpKernelInterface {
  const MASTER_REQUEST = 1;
  const SUB_REQUEST = 2;

  /**
   * Handles a Request to convert it to a Response.
   *
   * @param Request $request A Request instance
   * @param integer $type    The type of the request
   * @param Boolean $catch Whether to catch exceptions or not
   *
   * @return Response A Response instance
   */
  public function handle(Request $request, $type = self::MASTER_REQUEST, $catch = true);
}
            </code></pre>
          </section>
          <section>
            <h3>HttpKernel pipeline</h3>
            <img src="img/architecture-httpkernel.svg" class="graphic"/>
          </section>
        </section>
        <section>
          <section>
            <h2>Controllers</h2>
            <p class="fragment roll-in">(The concept formerly known as page callbacks and now represented by a PHP callable...)</p>
          </section>
          <section>
            <pre><code class="php">use Symfony\Component\HttpFoundation\Response;

class MyControllers {

  public function hello() {
    return new Response('&lt;html>&lt;body>Hello World&lt;/body>&lt;/html>');
  }
}
</code></pre>
          </section>
          <section>
            <pre><code class="php">use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\HttpFoundation\JsonResponse;

class MyControllers {

  public function hello() {
    return new Response('&lt;html>&lt;body>Hello World&lt;/body>&lt;/html>');
  }

  public function helloJson() {
    $data['Hello'] = 'World';
    return new JsonResponse($data);
  }
}
</code></pre>
          </section>
          <section>
            <pre><code class="php">class MyControllers {

  public function helloString() {
    return "The view event will turn this into a response.";
  }
}
</code></pre>
          </section>
          <section>
            <pre><code class="php">class MyControllers {

  public function helloDrupal() {
    return array(
      '#theme' => 'a_drupal_render_array',
      '#description' => 'Those still exist.',
    );
  }
}
</code></pre>
          </section>
          <section>
            <pre><code class="php">use Symfony\Component\HttpFoundation\StreamedResponse;

class MyControllers {

  public function helloCsvStream() {

    $some_data = $this->getFromSomewhere();

    $response = new StreamedResponse();
    $response->headers->set('Content-Type', 'text/csv');

    $response->setCallback(function () use ($some_data) {
      foreach ($some_data as $record) {
        print implode(', ', $record);
      }
    });
  }
}
</code></pre>
            <aside class="notes">
              This is how you send CSV data LIKE A BOSS.

              Segue: The most common example is just returning a file off disk...
            </aside>
          </section>
          <section>
            <pre><code class="php">use Symfony\Component\HttpFoundation\BinaryFileResponse;

class MyControllers {

  public function helloFile() {
    $response = new BinaryFileResponse('hello_world.png');

    // Do this in settings.php if you know you're on nginx or
    // have the Apache module enabled.
    $response::trustXSendfileTypeHeader();

    return $response;
  }
}
</code></pre>
            <aside class="notes">
              Drupalers wrote that. :-)
            </aside>

          </section>
          <section>
            <pre><code class="php">use Symfony\Component\HttpFoundation\Response;

class MyControllers {

  public function helloEmpty() {
    $this->doSomething();

    $response = new Response();
    $response->setStatusCode(204);
    return $response;
  }
}
</code></pre>
          </section>
          <section>
            <pre><code class="php">use Symfony\Component\HttpFoundation\Response;

class MyControllers {

  public function helloCoffee() {
    if ($this->isTeapot()) {
      $response = new Response("Don't put coffee in me", 418);
      return $response;
    }

    // ...
  }
}
</code></pre>
          </section>
          <section>
            <code>/hello/world/{from}/{to}</code>
            <pre><code class="php">class MyControllers {

  public function helloDrupal($to, $from, Request $request) {
    return array(
      '#theme' => 'love_letter',
      '#from' => $from,
      '#to' => $to,
    );
  }
}
</code></pre>
          </section>
          <section>
          <h3>mymodule.routing.yml</h3>
          <pre><code class="yaml long_code">mymodule.hello_world:
  path: '/hello/world/{from}/{to}'
  defaults:
    _content: '\Drupal\mymodule\Controller\HelloController::helloWorld'
  requirements:
    _permission: 'access content'
    from: \s+
    to: \s+
</code></pre>
          </section>

          <section>
            <h1>Your turn!</h1>
            <p><a href="https://github.com/palantirnet/hellodrupal">https://github.com/palantirnet/hellodrupal</a></p>
            <aside class="notes">
              Your task is to write 3 simple controllers.
              One returns the string "hello world", as a Drupal page.
              One returns a JSON string that says hello world.
              One accepts a name from the path and says "Hello $name", using
              a template.
          </section>
        </section>
        <section>
          <section>
            <h2>Routing</h2>
            <p class="fragment">(You don't need to know every detail of this.)</p>
            <aside class="notes">
              <ul>
                <li>This is mostly to show the thought process.</li>
                <li>Lots of little pieces working together.</li>
                <li>Swap them out individually.</li>
              </ul>
            </aside>
          </section>
          <section>
            <h2>It's all listeners</h2>
            <p>KernelEvents::REQUEST</p>
            <aside class="notes">
              <ul>
                <li>Think of it as hook_request_alter(). Kinda.</li>
                <li>"Stuff that happens before the controller."</li>
              </ul>
            </aside>
          </section>
          <section>
            <h3>Routing</h3>
            <img src="img/routing.svg" />
          </section>
          <section>
            <h3>Dynamic Router</h3>
            <img src="img/dynamic-router.svg" />
          </section>
          <section>
            <h2>Route Enhancers</h2>
            <pre><code class="php">class ContentControllerEnhancer implements RouteEnhancerInterface {
  protected $types = array(
    'drupal_dialog' => 'controller.dialog:dialog',
    'drupal_modal' => 'controller.dialog:modal',
    'html' => 'controller.page:content',
  );

  public function enhance(array $defaults, Request $request) {
    if (empty($defaults['_controller']) && !empty($defaults['_content'])) {
      $type = $this->negotiation->getContentType($request);
      if (isset($this->types[$type])) {
        $defaults['_controller'] = $this->types[$type];
      }
    }
    return $defaults;
  }
}
</code></pre>
          </section>
          <section>
            <h3>Access control</h3>
            <p class="fragment">Authentication vs. Authorization</p>
            <p class="fragment">(Yep, more listeners)</p>
            <aside class="notes">
              <ul>
                <li>Authentication: Who are you?</li>
                <li>Authorization: Are you allowed to do that?</li>
                <li>Mostly you'll deal with Authorization.</li>
              </ul>
            </aside>
          </section>
          <section>
            <h3>Authentication</h3>
            <p class="fragment">global $user is dead</p>
            <p class="fragment">Long live<br /><code>$request->attributes->get('_account')</code></p>
          </section>
          <section>
            <h3>Access control</h3>
            <ul>
              <li class="fragment">Multiple "checkers" per route</li>
              <li class="fragment">Applies or not</li>
              <li class="fragment">Allow, Deny, Kill</li>
              <li class="fragment">Any vs. All</li>
            </ul>
          </section>
          <section>
            <h2>Route with access</h2>
            <pre><code class="yaml">comment_edit_page:
  pattern: '/comment/{comment}/edit'
  defaults:
    _entity_form: 'comment.default'
  options:
    _access_mode: 'ANY'
  requirements:
    _entity_access: 'comment.update'
    _permission: 'edit any comment'
</code></pre>
          </section>

          <section>
            <h2>Permission check</h2>
            <pre class="long_code"><code class="php">class PermissionAccessCheck implements StaticAccessCheckInterface {
  public function appliesTo() {
    return array('_permission');
  }

  public function access(Route $route, Request $request) {
    $permission = $route->getRequirement('_permission');
    $account = $request->attributes->get('_account');
    return $account->hasPermission($permission) ? static::ALLOW : static::DENY;
  }
}
</code></pre>
          </section>
        </section>

        <section>
          <section>
            <h2>Dependency Injection</h2>
            <h3 class="fragment roll-in">It's way less scary than it sounds</h3>
          </section>

          <section>
            <h3>Dependency</h3>
            <p>An object on which your object depends</p>
          </section>
          <section>
            <h3>Service</h3>
            <p>A generally-stateless "global" object</p>
            <aside class="notes">
              <ul>
                <li>Stateless in the sense that once configured, it's idempotent.</li>
                <li>Globalness is not the object's job to enforce. It's the Container's job</li>
              </ul>
            </aside>
          </section>
          <section>
            <pre><code class="php">
class Status {
  public function show() {
    $status = db_query('SELECT status from {table}')->fetchOne();
    return $status;
  }
}

$status = new Status();
print $status->show();
</code></pre>
            <aside class="notes">
              <ul>
                <li>How do you test that? Depends on DB connection, can't control it.</li>
                <li>Need the function, need the DB fully configured and prepped... ugh.</li>
              </ul>
            </aside>
          </section>
          <section>
            <pre class="long_code"><code class="php">
class Status {
  protected $db;

  pubic function __construct(Database $db) {
    $this->db = $db;
  }

  public function show() {
    $status = $this->db->query('SELECT status from {table}')->fetchOne();
    return $status;
  }
}

$db = new Database();
$status = new Status($db);
print $status->show();
</code></pre>
            <aside class="notes">
              <ul>
                <li>Depend on interfaces, not concrete classes.</li>
                <li>Concrete class = still tightly coupled.</li>
              </ul>
            </aside>
          </section>
          <section>
            <pre class="long_code"><code class="php">
class Status {
  protected $db;

  pubic function __construct(DatabaseInterface $db) {
    $this->db = $db;
  }

  public function show() {
    $status = $this->db->query('SELECT status from {table}')->fetchOne();
    return $status;
  }
}

$db = new Database();
$status = new Status($db);
print $status->show();
</code></pre>
            <aside class="notes">
              <ul>
                <li>Now I can fake the database!</li>
                <li>How do I configure the database?</li>
              </ul>
            </aside>
          </section>
          <section>
            <pre class="long_code"><code class="php">
class Status {
  protected $db;

  pubic function __construct(Database $db) {
    $this->db = $db;
  }

  public function show() {
    $status = $this->db->query('SELECT status from {table}')->fetchOne();
    return $status;
  }
}

$db_settings = array(...);
$db = new Database($db_settings);
$status = new Status($db);
print $status->show();
</code></pre>
            <aside class="notes">
              <ul>
                <li>Starting to get ugly...</li>
              </ul>
            </aside>
          </section>
          <section>
            <h3>Dependency Injection "Container"</h3>
            <p class="fragment">"Place where you wire that stuff up in advance"</p>
            <p class="fragment">"Scariest possible name for an array of objects"</p>
            <pre class="fragment"><code class="long_code php">
$status = $container->get('status');
print $status->show();

</code></pre>
            <aside class="notes">
              <ul>
                <li>Container sees that "status" means the Status class</li>
                <li>Container sees Status service has a "dependency" on the DB</li>
                <li>Container creates the DB</li>
                <li>Container creates Status using the DB</li>
                <li>Container returns Status</li>
                <li>Neither Status or the DB are the wiser!</li>
              </ul>
            </aside>
          </section>
          <section>
            <h3>Dependency Injection Container</h3>
            <ul>
              <li class="fragment">You'll <em>almost</em> never interact with it directly</li>
              <li class="fragment">Configure via... YAML</li>
              <li class="fragment">Your classes <em>should not</em> know about it</li>
              <li class="fragment">Focus on testability and swappability</li>
            </ul>
          </section>
          <section>
            <h3>core.services.yml</h3>
             <pre class="fragment long_code"><code class="yaml">services:
  router.dynamic:
    class: Symfony\Cmf\Component\Routing\DynamicRouter
    arguments: ['@router.request_context', '@router.matcher', '@url_generator']
  legacy_url_matcher:
    class: Drupal\Core\LegacyUrlMatcher
  legacy_router:
    class: Symfony\Cmf\Component\Routing\DynamicRouter
    arguments: ['@router.request_context', '@legacy_url_matcher', '@legacy_generator']
  router:
    class: Symfony\Cmf\Component\Routing\ChainRouter
    calls:
      - [setContext, ['@router.request_context']]
      - [add, ['@router.dynamic']]
      - [add, ['@legacy_router']]</code></pre>
            <pre class="fragment"><code class="php">
public function createRouter() {
  $router = new \Symfony\Cmf\Component\Routing\ChainRouter(
    $this->createDynamicRouter(),
    $this->createLegacyRouter()
  );
  $router->setContext($this->createRouterRequestContext());
  $router->add($router_dynamic);
  $router->add($legacy_router);
  return $router;
}
</code></pre>
            <aside class="notes">
              <ul>
                <li>Start with router...</li>
                <li>Generated code is a bit different, but close.</li>
                <li>None of these object know about it</li>
                <li>Each tested in isolation</li>
              </ul>
            </aside>
          </section>
        </section>
<!-- Robin's Config Slides -->
        <section>
          <section>
            <h2>Configuration Management</h2>
          </section>
          <section>
            <h2>Configuration Management (CMI)</h2>
            <ul>
              <li>Configuration is everything users and editors do not write</li>
              <li>It's translatable</li>
              <li>Usual Suspects:</li>

              <ul>
                <li>views</li>
                <li>view modes</li>
                <li>image styles</li>
                <li>perms</li>
                <li>content types</li>
                <li>settings</li>
              </ul>
            </ul>
          </section>
          <section>
            <h2>Config:  It's in the Files!</h2>
            <ul>
              <li>elminated 50 tables from the drupal db</li>
              <li>writes directly to files not the db</li>
              <li>written in yml, not too hard to write/read and maps to arrays</li>
            </ul>
            <pre><code class="php">
base_field: nid
base_table: node
core: 8.x
description: 'Find and manage content.'
status: '1'
display:
  default:
    display_options:
      access:
        type: perm
        options:
          perm: 'access content overview'
      cache:
        type: none
      query:
        type: views_query
      exposed_form:
        type: basic
        options:
          submit_button: Filter
          reset_button: '0'
          reset_button_label: Reset
          exposed_sorts_label: 'Sort by'
              </code></pre>
            <aside class="notes">
              what does this yml snippet look like to you?<br/>
              new line characters denote end of value<br/>
              indenting allows for more complex data structures<br/>
              note the use of single quotes!  different from Annotations<br/>
              more to add here!!! @todo
            </aside>
          </section>
        </section>
<!-- Robin's Config Slides End -->
<!-- Robin's Forms -->
        <section>
          <section>
            <h2>Forms</h2>
          </section>
          <section>
            <h2>Forms</h2>
            <p>Let's go!</p>
            <p>Create Admin Settings</p>
            <p>Here's how</p>
            <aside class="notes">
              LetÔøΩs get into it right away<br/>
              show the admin setting in your site<br/>
              i need config settings for my module...<br/>
              something an admin can maniuplate via the UI.<br/>
            </aside>
          </section>
          <section>
            <h2>Settings Form Need</h2>
            <ul>
              <li>a route</li>
              <li>config schema</li>
              <li>default values</li>
              <li>a form that extends SystemConfigFormBase</li>
              <li>hook_menu() so it can be visible in navigation</li>
            </ul>
            <aside class="notes">
            you need a route<br/>
            you need a settings schema<br/>
            you probably want default setting values<br/>
            you need form that extends SystemConfigFormBase<br/>
          </section>
          <section>
            <h2>Route to the form</h2>
            <pre><code class="yml">
drupalgotchi/drupalgotchi.routing.yml

---

drupalgotchi_settings:
  pattern: '/admin/config/system/drupalgotchi'
  defaults:
    _form: '\Drupal\drupalgotchi\Form\SettingsForm'
  requirements:
    _permission: 'administer drupalgotchi'

            </code></pre>
          </section>
          <section>
            <h2>Configuration Schema</h2>
            <pre><code class="php">
drupalgotchi/config/schema/drupalgotchi.settings.yml

---

# Schema for the configuration files of the Action module.

drupalgotchi.settings:
  type: mapping
  label: 'Drupalgotchi settings'
  mapping:
    name:
      type: string
      label: "The name of your site's persona"
    needy:
      type: integer
      label: 'How needy your site is'
            </code></pre>
          </section>
          <section>
            <h2>Default Values for Settings</h2>
            <p>same file name, different location</p>
            <pre><code class="php">
drupalgotchi/config/drupalgotchi.settings.yml

---

needy: 10
name: ''

            </code></pre>
          </section>
          <section>
            <h2>SystemConfigFormBase</h2>
            <p>Note how the __construct() uses ConfigFactory</p>
            <pre><code class="php">
drupalgotchi/lib/Drupal/drupalgotchi/Form/SettingsForm.php

---

class SettingsForm extends SystemConfigFormBase {

  protected $config;

  public function __construct(Config $config) {
    $this->config = $config;
  }

  public static function create(ContainerInterface $container) {
    return new static(
      $container->get('config.factory')->get('drupalgotchi.settings')
    );
  }

  public function getFormID() {
    return 'drupalgotchi_settings';
  }

            </code></pre>
            <aside class="notes">
              Form extends SystemConfigFormBase
              ConfigFactory lets us have a schema and default values<br/>
            </aside>
          </section>
          <section>
            <h3>SettingsForm (continued)</h3>
            <pre><code class="php">
drupalgotchi/lib/Drupal/drupalgotchi/Form/SettingsForm.php

---

  public function buildForm(array $form, array &$form_state) {

    $form['name'] = array(
      '#title' => t('Name'),
      '#description' => t('What is your site animal\'s name?'),
      '#type' => 'textfield',
      '#default_value' => $config->get('name'),
    );

    $form['needy'] = array(
      '#title' => t('Neediness'),
      '#description' => t('How needy the site is for attention. Range is from 1-10.'),
      '#type' => 'range',
      '#step' => 1,
      '#min' => 1,
      '#max' => 10,
      '#default_value' => $config->get('needy'),
    );

    return parent::buildForm($form, $form_state);
  }
            </code></pre>
            <aside class="notes">
              machine name in getFormID() - easy enough<br/>
              buildForm (don't those args look familiar?!)<br/>
              and look at that $form array...we can handle that!<br/>
              now we see the power of the configFactory in submitForm<br/>
              set the values and call save()<br/>
            </aside>
          </section>
          <section>
            <h3>SettingsForm</h3>
            <pre><code class="php">
drupalgotchi/lib/Drupal/drupalgotchi/Form/SettingsForm.php

---

  public function submitForm(array &$form, array &$form_state) {
    parent::submitForm($form, $form_state);

    $config->set('name', $form_state['values']['name']);
    $config->set('needy', $form_state['values']['needy']);

    $config->save();
  }
} // end of class
            </code></pre>

          </section>
          <section>
            <h2>now, you try!</h2>
          </section>
          <section>
            <h2>Forms and Config</h2>
            <ul>
              <li>FormInterface</li>
              <ul>
                <li>build</li>
                <li>validate</li>
                <li>submit</li>
              </ul>
              <li>Admin settings use case</li>
            </ul>
            <aside class="notes">
              forms now rely in the FormInterface<br/>
              build, validate, submit -
              pretty straightforward and all in one place!  easy to read!<br/>
              system settings have a special use case where the form can rely on module configuration<br/>
              switch to netbeans and click through classes and interfaces
            </aside>
          </section>
        </section>
<!-- Robin's Form Slides End -->
<!-- Robin's Plugins Slides -->
        <section>
          <section>
            <h2>Plugins</h2>
            <aside class="notes">
                (hit 's' on your keyboard to see me.)
                What is a plugin?
            </aside>
          </section>
          <section>
            <h3>Plugins</h3>
            <p>A narrow set of functionality</p>
            <hr/>
            <h3>Plugin Systems</h3>
            <p>allows customization and extension of the original system</p>
            <ul>
              <li>e.g. graphics software: processing image files</li>
            </ul>
            <hr/>
            <p>In Drupal 7?</p>
            <aside class="notes">
            in general plugins provide a narrow set of functionality<br/>
            a plugin framework or system allows customization and extension of the original system
            examples outside of drupal<br/>
            graphics software use plugins to apply filters and other processes to an image (photoshop) file<br/>
            web browsers use plugins for playing video and java apps<br/>
            in d7 we have most notably ctools plugins<br/>
            who knows of any other plugin systems in D7? jquery plugins? others?<br/>
            </aside>
          </section>
          <section>
            <h2>One plugin system<br/>to rule them all!</h2>
            <p>a new universal plugin system supports:</p>
            <ol>
              <li>plugin types</li>
              <li>plugin discovery</li>
              <li>plugin factory</li>
            </ol>
            <p>Managers define and manage</p>
            <aside class="notes">
            <p>Drupal 8 One plugin system to rule them all!</p>
              <p>in d8, we have a new universal plugin system available via core.
                This system has three base elements:</p>
              <ol>
                <li>plugin types - a controlling class that defines how plugins will be discovered and instantiated. plugin types are the OO solution for info hooks.</li>
                <li>plugin discovery - finds plugins in the code base to apply</li>
                <li>plugin factory - instantiates specific plugins as needed</li>
              </ol>
              each type of plugin has a manager that defines and controls three of these things<br/>
              e.g. BlockManager, ArchiverManager, EditorManager
              <p>(maybe) other components that could be useful:
              plugin derivatives, discovery decorators and plugin mappers.</p>
            </aside>
          </section>
          <section>
            <h2>Plugin Types</h2>
            <ul>
              <li>Blocks</li>
              <li>Actions</li>
              <li>Views</li>
              <li>[field]Formatters</li>
            </ul>
            <p>Example of a block plugin</p>
            <pre><code class="php fragment">
/* Annotation */
class HelloBlock extends BlockBase {

  public function settings() {  }

  public function blockForm($form, &$form_state) {  }

  public function blockSubmit($form, &$form_state) {  }

  public function build() {  }
}
            </code></pre>

            <aside class="notes">
        plugin types<br/>
        Some examples:  blocks, actions, views (field)Formatters.  Sound familiar?<br/>
        let's see an example
            </aside>
          </section>
          <section>
            <h2>What is Plugin &quot;Discovery&quot;?</h2>
            <p>find plugins, metadata</p>
            <p>parse plugin metadata</p>
            <p>use annotated class discovery<p>
            <pre><code class="php fragment rollin">
modulename/
  lib/
    Drupal/
      modulename/
        Plugin/
          plugintype/
            pluginname.php
---

action/
  lib/
    Drupal/
      action/
        Plugin/
          Action/
            EmailAction.php
            </code></pre>
            <aside class="notes">
              designed to replace info hooks<br/>
              finds plugins, finds metadata and parses it<br/>
              takes returned metadata and instantiates objects(factory)<br/>
              annotated class discovery - use this one<br/>
              plugins are all located in the same place no matter if it's a core module or contrib<br/>
              other types of discovery:<br/>
              discovery - uses module_invoke_all (don't use this, support for legacy code)<br/>
              static discovery - mostly used for tests, not intelligent<br/>
            </aside>
          </section>
          <section>
            <h2>Metadata</h2>
            <p>Annotations provide the metadata</p>
            <p>Annotation Types e.g.  EntityType, ActionType
            <pre><code class="php">
use Drupal\Component\Annotation\Plugin; /* required */

/**
* @Plugin(
*   ...
* )
*/
            </code></pre>
            <p>Appears just above your plugin class</p>
          </section>
          <section>
            <h2>Annotations</h2>
            <ul>
              <li>key-value data structures with nesting support</li>
            </ul>
            <pre><code class="php">
/**
* Provides a  hello block.
*
* @Plugin(
*  id = "hellodrupal_hello",
*  admin_label = @Translation("Hello World"),
*  module = "hellodrupal"
* )
*/
            </code></pre>
            <ul>
              <li>what key-value pairs? check the  annotation type class:</li>
            </ul>
            <p style="font-size:.5em"><code>core/lib/Drupal/core/Entity/Annotations/EntityType.php</code></p>
            <aside class="notes">
              a bit about annotations in general<br/>
          </section>
          <section>
            <h2>Annotation Tips</h2>
            <ul>
              <li>id = machine_name</li>
              <li>Always use double quotes</li>
              <li>Strings must use quotes</li>
              <li>Numbers and Booleans must NOT use quotes</li>
              <li>No trailing commas!</li>
              <li>Doctrine:  http://docs.doctrine-project.org/en/2.0.x/reference/annotations-reference.html</li>
            </ul>
            <pre><code class="php">
/**
* Provides a  hello block.
*
* @Plugin(
*  id = "drupalgotchi_hello",
*  admin_label = @Translation("Hello World"),
*  module = "hellodrupal"
* )
*/
            </code></pre>
            <aside class="notes">
              annotations are inherently key-value data structures, with support for nesting.<br/>
              Single quotes throw an exception.<br/>
            </aside>
          </section>
          <section>
            <h2>Exercise:  Create a block</h2>
            <ul>
              <li>Set metadata (annotations) to HelloBlock.php</li>
              <li>create the render array</li>
              <li>create a template file</li>
              <li>notify theme layer about our new template</li>
              <li>enable drupalgotchi module</li>
              <li>place HelloBlock</li>
            </ul>
          </section>
          <section>
            <h4>Create a block (hint)</h4>
            <ul>
              <li>HelloBlock.php</li>
              <li>Set the metadata (in Annotations)</li>
            <pre class="fragment"><code class="php">
/**
* Provides a hello block.
*
* @Plugin(
*  id = "drupalgotchi_hello",
*  admin_label = @Translation("Hello World"),
*  module = "hellodrupal"
* )
*/
            </code></pre>
              <li>pull in settings</li>
            </ul>
            <pre class="fragment"><code class="php">
public function settings() {
  return array(
    'person' => 'World',
  );
}
            </code></pre>
            <aside class="notes">
              find HelloBlock.php<br/>
              add metadata via Annotations<br/>
              allow settings<br/>
              create a render array<br/>
              create a template file<br/>
              notify theme layer about our new template<br/>
              enable drupalgotchi module<br/>
              place HelloBlock<br/>
              then back to this slide<br/>
            </aside>
          </section>
          <section>
            <h4>Create a block (hint)</h4>
            <ul>
              <li>create the render array</li>

            <pre class="fragment"><code class="php">
public function build() {
  return array(
    '#theme' => 'hellodrupal_hello_block',
    '#person' => $this->configuration['person'],
  );
}
            </code></pre>
            <li>create the template file</li>

            <pre class="fragment"><code class="php">
hellodrupal/templates/hellodrupal-hello-block.html.twig

---

<p>
{% trans %}
  Hello there. My name is {{ name }}!
{% endtrans %}
</p>
            </code></pre>
            </ul>
          </section>
          <section>
            <h4>Create a block (hint)</h4>
            <ul>
            <li>notify the theme about your new template file</li>
            <pre class="fragment"><code class="php">
function hellodrupal_theme() {
  return array(
    'hellodrupal_hello_block' => array(
      'variables' => array('person' => NULL),
      'template' => 'hellodrupal-hello-block',
    )
  );
}
            </code></pre>
</ul>
          </section>
        </section>
<!-- Robin's Plugins Slides End -->
<!-- Wrap up slides -->
        <section>
          <section>
            <h1>Review and wrap-up</h1>
            <h2 style="margin-top: 1em;">Key take-aways</h2>
          </section>
          <section>
            <h3>Think in loosely coupled objects,<br />not just loosely coupled modules</h3>
            <aside class="notes">
              <ul>
                <li></li>
              </ul>
            </aside>
          </section>
          <section>
            <h3>Separate business logic from glue code</h3>
            <aside class="notes">
              <ul>
                <li></li>
              </ul>
            </aside>
          </section>
          <section>
            <h3>Display logic happens<br />at the display layer</h3>
            <aside class="notes">
              <ul>
                <li>Twig does way more than PHPTemplate ever did</li>
                <li>Let it do it; Keep your themers happy</li>
              </ul>
            </aside>
          </section>
          <section>
            <h2 style="color: #a31; font-size: 256px; text-shadow: 1px 1px 1px #800;">Don't Panic</h2>
          </section>
          <section>
            <h3>The future is a very different place</h3>
            <h3 class="fragment roll-in">But a really cool one</h3>
            <h3 class="fragment roll-in">(Always bring your towel)</h3>
            <aside class="notes">
              <ul>
                <li></li>
              </ul>
            </aside>
          </section>
          <section>
            <h2>Survey</h2>
          </section>
          <section>
            <h2>Thank you!</h2>
            <p>See you online!</p>
            <ul>
              <li><a href="http://www.twitter.com/Crell">@Crell</a></li>
              <li><a href="http://www.twitter.com/robinbarre">@RobinBarre</a></li>
            </ul>
          </section>
        </section>
        <section>
          <h2>Credits</h2>
          <p>Slides: Larry Garfield, Robin Barre</p>
          <p>Graphics: Larry Garfield, Ashley Cyborski</p>
          <p>©2013 <a href="http://www.palantir.net/">Palantir.net</a></p>
          <p style="margin-top: 1em;">Interested in website development or training?<br /><a href="http://palantir.net/contact">Drop us a line!</a></p>
        </section>
      </div><!-- end div for all slides -->

      <aside class="logo">
      <img src="img/logo.png">
      </aside>

    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
          // { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
          // { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>

  </body>
</html>
